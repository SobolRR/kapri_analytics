(this.webpackJsonpkapri_analytics=this.webpackJsonpkapri_analytics||[]).push([[0],{192:function(t,e,n){},347:function(t,e,n){"use strict";n.r(e);var r=n(7),a=n(0),c=n.n(a),o=n(29),i=n.n(o),s=(n(192),n(170)),u=n(171),l=n(185),d=n(182),b=n(30),j=n(24),f=n(69),m=n(32),p=n.n(m),O=n(51),h=n(39),x=n(349),y="YYYY-MM-DD HH:mm:ss",v={girls:["\u0410\u043a\u0441\u0435\u0441\u0441\u0443\u0430\u0440\u044b","\u0411\u043e\u0434\u0438 (\u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0440\u0443\u043a\u0430\u0432)","\u0411\u043e\u0434\u0438 (\u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u0440\u0443\u043a\u0430\u0432)","\u041a\u043e\u0444\u0442\u044b","\u041d\u0430\u0431\u043e\u0440\u044b","\u041f\u0435\u0441\u043e\u0447\u043d\u0438\u043a","\u041f\u0438\u0436\u0430\u043c\u044b","\u041f\u043b\u0430\u0442\u044c\u044f","\u0420\u0435\u0433\u043b\u0430\u043d\u044b","\u0424\u0443\u0442\u0431\u043e\u043b\u043a\u0438","\u0427\u0435\u043b\u043e\u0432\u0435\u0447\u043a\u0438","\u0428\u043e\u0440\u0442\u044b","\u0428\u0442\u0430\u043d\u044b"],boys:["\u0410\u043a\u0441\u0435\u0441\u0441\u0443\u0430\u0440\u044b","\u0411\u043e\u0434\u0438 (\u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0440\u0443\u043a\u0430\u0432)","\u0411\u043e\u0434\u0438 (\u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u0440\u0443\u043a\u0430\u0432)","\u041a\u043e\u0444\u0442\u044b","\u041d\u0430\u0431\u043e\u0440\u044b","\u041f\u0435\u0441\u043e\u0447\u043d\u0438\u043a","\u041f\u0438\u0436\u0430\u043c\u044b","\u0420\u0435\u0433\u043b\u0430\u043d\u044b","\u0424\u0443\u0442\u0431\u043e\u043b\u043a\u0438","\u0427\u0435\u043b\u043e\u0432\u0435\u0447\u043a\u0438","\u0428\u043e\u0440\u0442\u044b","\u0428\u0442\u0430\u043d\u044b"]},k={"\u0414\u0420":"\u0411\u043e\u0434\u0438 (\u0434\u043b\u0438\u043d\u043d\u044b\u0439 \u0440\u0443\u043a\u0430\u0432)","\u041a\u0420":"\u0411\u043e\u0434\u0438 (\u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u0440\u0443\u043a\u0430\u0432)","\u041a\u043e\u0444\u0442":"\u041a\u043e\u0444\u0442\u044b","\u041d\u0430\u0431\u043e\u0440":"\u041d\u0430\u0431\u043e\u0440\u044b","\u041f\u0435\u0441\u043e\u0447\u043d\u0438\u043a":"\u041f\u0435\u0441\u043e\u0447\u043d\u0438\u043a","\u041f\u0438\u0436\u0430\u043c":"\u041f\u0438\u0436\u0430\u043c\u044b","\u041f\u043b\u0430\u0442\u044c":"\u041f\u043b\u0430\u0442\u044c\u044f","\u0420\u0435\u0433\u043b\u0430\u043d":"\u0420\u0435\u0433\u043b\u0430\u043d\u044b","\u0424\u0443\u0442\u0431\u043e\u043b\u043a":"\u0424\u0443\u0442\u0431\u043e\u043b\u043a\u0438","\u0427\u0435\u043b\u043e\u0432\u0435\u0447":"\u0427\u0435\u043b\u043e\u0432\u0435\u0447\u043a\u0438","\u0428\u043e\u0440\u0442\u044b":"\u0428\u043e\u0440\u0442\u044b","\u0428\u0442\u0430\u043d\u044b":"\u0428\u0442\u0430\u043d\u044b","\u041b\u043e\u0441\u0438\u043d\u044b":"\u0428\u0442\u0430\u043d\u044b","\u041a\u043e\u0441\u0442\u044e\u043c":"\u041d\u0430\u0431\u043e\u0440\u044b"},S=["NB","0-3","1-2","2-4","3-6","4-6","6-9","9-12","12-18","18-24","24-36"],g=["all","bi baby","bimini","biorganic","Disney baby","DreamKid","Dunnes","H&M","Little Angel","George","little life","Marks & Spencer","Matalan","Next","Tasco","KEHA","\u041c\u0430\u043c\u0438\u043d\u0435 \u0447\u0443\u0434\u043e"],w=n(91),I=n(28);function C(t){return t.match(/([0-9]+)-([0-9]+)|NB/g)[0]}function F(t,e){return"girls"===t||"common"===t?e.girls:e.boys}function R(t,e,n,r){switch(t){case"sales":return-1!==S.indexOf(e)?r&&"".concat(n.showSellSum?n.additionalData.sellSum[e]:r," (").concat((100*n.additionalData.sellSum[e]/n.totalSellSum).toFixed(2),"%)"):r;default:return r}}var D=function(t,e){var n=t.name.toLowerCase(),r=e.name.toLowerCase();return n<r?-1:n>r?1:0};var E={brandsReport:function(t){return function(e,n){return parseFloat(e[t])-parseFloat(n[t])}},sales:function(t){return function(e,n){return parseInt(e[t])-parseInt(n[t])}}};function z(t,e){var n=t.map((function(t,n){var a=E[e]&&-1===S.indexOf(t)?{sorter:E[e](t)}:{};return Object(I.a)(Object(I.a)({title:t,dataIndex:t,key:n},a),{},{render:function(n,a){return{props:{style:{background:function(t,e){return"total"===t?"white":parseInt(e)>0?"#C7E78F":"#e6948e"}(t,n)}},children:Object(r.jsxs)("div",{children:[R(e,t,a,n)," "]})}}})}));return n.unshift({title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",key:"name",sorter:D,width:200}),n}var B=[].concat(Object(w.a)(S),["total"]),N=z([].concat(Object(w.a)(S),["total","totalSellSum"]),"sales"),M=z(B,"stock"),T=z(["sum","profit","profitability"],"brandsReport"),A=n(130),L=n.n(A),_=n(33),K=n.n(_),H={girls:"https://online.moysklad.ru/api/remap/1.2/entity/productfolder/c9ac503e-1d16-11eb-0a80-050d002dcd9a",boys:"https://online.moysklad.ru/api/remap/1.2/entity/productfolder/00cfa023-1d16-11eb-0a80-050d002dade8",unisex:"https://online.moysklad.ru/api/remap/1.2/entity/productfolder/73475072-28e9-11eb-0a80-029000103030"};L.a.defaults.headers.post["Content-Type"]="application/json";var Y=L.a.create({baseURL:"https://kapri-server.herokuapp.com"}),J=function(){var t=Object(O.a)(p.a.mark((function t(e){var n,r,a,c,o,i;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.folderName,r=e.inTransit,a=r?"all":"positiveOnly",c="common"===n?"":"&filter=productFolder=".concat(H[n]),o="https://online.moysklad.ru/api/remap/1.2/report/stock/all?groupBy=consignment&filter=stockMode=".concat(a,"&filter=inTransitOnly=").concat(r)+c,t.next=6,Y.post("/",{link:o});case 6:return i=t.sent,t.abrupt("return",i.data);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P=function(){var t=Object(O.a)(p.a.mark((function t(e){var n,r,a,c,o,i=arguments;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"2020-11-01 00:00:00",r=i.length>2&&void 0!==i[2]?i[2]:K()(new Date).format(y),a=e?"&filter=counterparty=".concat(e):"",c="https://online.moysklad.ru/api/remap/1.2/report/profit/byvariant?momentFrom=".concat(n,"&momentTo=").concat(r)+a,t.next=6,Y.post("/",{link:c});case 6:return o=t.sent,t.abrupt("return",o.data);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Q=function(){var t=Object(O.a)(p.a.mark((function t(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://online.moysklad.ru/api/remap/1.2/report/profit/bycounterparty",t.next=3,Y.post("/",{link:"https://online.moysklad.ru/api/remap/1.2/report/profit/bycounterparty"});case 3:return e=t.sent,t.abrupt("return",e.data);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),G=n(92),U=n(108),q=n(57),V=n(65);var W=function(t,e){return t.filter((function(t){return-1!==t.name.indexOf(e)}))};function X(t,e,n){var r=function(t){return F(t,v).map((function(t){return{name:t,sizes:S.reduce((function(t,e){return Object(I.a)(Object(I.a)({},t),{},Object(V.a)({},e,{width:0,depth:0,inTransit:0}))}),{})}}))}(e);return t.forEach((function(t){var e=C(t.name);r.forEach((function(r){t.folder.name===r.name&&r.sizes[e]&&(r.sizes[e].width+=1,r.sizes[e].depth+=n?t.inTransit:t.stock)}))})),r}function Z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=F(t,v),r=S.reduce((function(t,n){return Object(I.a)(Object(I.a)({},t),{},Object(V.a)({},n,e))}),{});return n.map((function(t,n){return Object(I.a)(Object(I.a)({key:n,name:t,NB:e},r),{},{total:e})}))}var $=function(t){var e=t.fetchFunc,n=Object(a.useState)(null),c=Object(h.a)(n,2),o=c[0],i=c[1],s=Object(a.useState)(!1),u=Object(h.a)(s,2),l=u[0],d=u[1],b=Object(a.useState)(!1),m=Object(h.a)(b,2),y=m[0],v=m[1],k=Object(a.useState)("all"),S=Object(h.a)(k,2),w=S[0],I=S[1],C=Object(j.e)().sex,F=Object(r.jsx)(f.a,{theme:"dark",selectedKeys:[w],children:g.map((function(t){return Object(r.jsx)(f.a.Item,{onClick:function(){I(t)},children:t},t)}))}),R=function(){var t=Object(O.a)(p.a.mark((function t(){var e,n,r,a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Z(C),d(!0),n={folderName:C,inTransit:y},t.next=5,J(n);case 5:r=t.sent,"all"!==w&&(r=W(r,w)),a=X(r,C,y),e.forEach((function(t){var e=a.find((function(e){return t.name===e.name})),n=0,r=0;for(var c in e.sizes)n+=e.sizes[c].width,r+=e.sizes[c].depth,t[c]="".concat(e.sizes[c].depth," (").concat(e.sizes[c].width,") ");t.total="".concat(r," (").concat(n,")")})),i(e),d(!1);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){R(e)}),[C,y,w]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(U.a,{overlay:F,placement:"bottomCenter",children:Object(r.jsx)(q.a,{children:"\u0411\u0440\u0435\u043d\u0434"})}),Object(r.jsx)(G.a,{style:{marginLeft:"30px"},onChange:function(){return v((function(t){return!t}))},children:"In transit"}),Object(r.jsx)(x.a,{dataSource:o,columns:M,columnstock:"3px",pagination:!1,bordered:!0,loading:l})]})},tt=n(350),et={boys:"\u041c",girls:"\u0414",unisex:"\u0423"};function nt(t,e){return t.filter((function(t){return function(t,e){var n="^[".concat(et[e],"]{1}"),r=t.match(n);if(r)return et[e]===r[0]}(t.assortment.name,e)}))}function rt(t,e,n,r){var a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=F(t,v),a=S.reduce((function(t,n){return Object(I.a)(Object(I.a)({},t),{},Object(V.a)({},n,e))}),{});return r.map((function(t,r){return Object(I.a)(Object(I.a)({key:r,name:t,NB:e},a),{},{total:e,totalSellSum:e,additionalData:{sellSum:{}},showSellSum:n})}))}(n,0,r);return t.forEach((function(t){(function(t,e){return t.filter((function(t){return-1!==t.assortment.name.indexOf(e)}))})(e,t).forEach((function(e){var n=function(t,e){return t.find((function(t){return t.name===k[e]}))}(a,t),r=C(e.assortment.name);n[r]+=e.sellQuantity,n.total+=e.sellQuantity,n.sellSum=+e.sellSum,n.totalSellSum+=Number((e.sellSum/100).toFixed(0)),function(t,e,n){var r=t.additionalData.sellSum[n],a=(e.sellSum/100).toFixed(0);r?t.additionalData.sellSum[n]+=Number(a):t.additionalData.sellSum[n]=Number(a)}(n,e,r)}))})),a}var at=n(128),ct=n.n(at),ot=Object.keys(k),it=tt.a.RangePicker,st=function(t){var e=t.counterparties,n=Object(j.e)().sex,c=Object(a.useState)(null),o=Object(h.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(!1),l=Object(h.a)(u,2),d=l[0],b=l[1],m=Object(a.useState)(null),v=Object(h.a)(m,2),k=v[0],S=v[1],g=Object(a.useState)(!0),w=Object(h.a)(g,2),I=w[0],C=w[1],F=e&&Object(r.jsxs)(f.a,{theme:"dark",selectedKeys:[k?k.name:"All"],children:[Object(r.jsx)(f.a.Item,{onClick:function(){S(null)},children:"All"},"All"),e.map((function(t){return Object(r.jsx)(f.a.Item,{onClick:function(){S(t.counterparty)},children:t.counterparty.name},t.counterparty.name)}))]}),R=function(){var t=Object(O.a)(p.a.mark((function t(e,r,a){var c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b(!0),t.next=3,P(e,r,a);case 3:c=t.sent,c="common"===n?c:nt(c,n),s(rt(ot,c,n,I)),b(!1);case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){var t=k?k.meta.href:k;R(t)}),[n,k,I]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(it,{onChange:function(t){R(k,K()(t[0]._d).format(y),K()(t[1]._d).format(y))},format:y,size:"large"}),Object(r.jsx)(U.a,{overlay:F,placement:"bottomCenter",children:Object(r.jsx)(q.a,{children:k?k.name:"\u041a\u043e\u043d\u0442\u0440\u0430\u0433\u0435\u043d\u0442"})}),Object(r.jsx)(ct.a,{checked:I,style:{marginLeft:"30px"},onChange:function(){return C((function(t){return!t}))},children:"SellSum"}),Object(r.jsx)(x.a,{dataSource:i,columns:N,columnstock:"3px",pagination:!1,bordered:!0,loading:d})]})};function ut(){var t=Object(w.a)(g);return t.shift(),t.map((function(t,e){return{key:e,name:t,sum:0,profit:0,sellCostSum:0,profitability:0}}))}var lt=function(t,e){return t.filter((function(t){return-1!==t.assortment.name.indexOf(e)}))},dt=tt.a.RangePicker,bt=function(){var t=Object(j.e)().sex,e=Object(a.useState)(ut()),n=Object(h.a)(e,2),c=n[0],o=n[1],i=Object(a.useState)(!1),s=Object(h.a)(i,2),u=s[0],l=s[1],d=function(){var e=Object(O.a)(p.a.mark((function e(n,r){var a,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,P(void 0,n,r);case 3:a=e.sent,a="common"===t?a:nt(a,t),c=ut(),g.forEach((function(t){lt(a,t).forEach((function(e){var n=c.findIndex((function(e){return e.name===t}));n>-1&&(c[n]=Object(I.a)(Object(I.a)({},c[n]),{},{sum:c[n].sum+=+e.sellSum,profit:c[n].profit+=+e.profit,sellCostSum:c[n].sellCostSum+=+e.sellCostSum}))}))})),c=c.map((function(t){var e=+(100*t.profit/t.sellCostSum).toFixed(2);return Object(I.a)(Object(I.a)({},t),{},{sum:(t.sum/100).toFixed(2),profit:(t.profit/100).toFixed(2),profitability:e?e+"%":0})})),o(c),l(!1);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){d()}),[t]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(dt,{onChange:function(t){d(K()(t[0]._d).format(y),K()(t[1]._d).format(y))},format:y,size:"large"}),Object(r.jsx)(x.a,{style:{width:"70vw"},dataSource:c,columns:T,columnstock:"3px",pagination:!1,bordered:!0,loading:u})]})},jt=f.a.SubMenu,ft=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(t=e.call.apply(e,[this].concat(a))).state={current:null,counterparties:null},t.handleClick=function(e){t.setState({current:e.key})},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;Q().then((function(e){t.setState({counterparties:e})}))}},{key:"render",value:function(){var t=this,e=this.state.current;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(f.a,{onClick:this.handleClick,selectedKeys:[e],mode:"horizontal",theme:"dark",children:[Object(r.jsxs)(jt,{title:"\u041c\u0430\u043b\u044c\u0447\u0438\u043a\u0438",children:[Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/stock/boys",children:"O\u0441\u0442\u0430\u0442\u043a\u0438 "})},"boysStock"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/sales/boys",children:"\u041f\u0440\u043e\u0434\u0430\u0436\u0438 "})},"boysSales"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/brandsReport/boys",children:"\u041e\u0442\u0447\u0435\u0442 \u043f\u043e \u0431\u0440\u0435\u043d\u0434\u0430\u043c "})},"boysBrandReport")]},"boys"),Object(r.jsxs)(jt,{title:"\u0414\u0435\u0432\u043e\u0447\u043a\u0438",children:[Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/stock/girls",children:"O\u0441\u0442\u0430\u0442\u043a\u0438 "})},"girlsStock"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/sales/girls",children:"\u041f\u0440\u043e\u0434\u0430\u0436\u0438 "})},"girlsSales"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/brandsReport/girls",children:"\u041e\u0442\u0447\u0435\u0442 \u043f\u043e \u0431\u0440\u0435\u043d\u0434\u0430\u043c "})},"girlsBrandReport")]},"girls"),Object(r.jsxs)(jt,{title:"\u0423\u043d\u0438\u0441\u0435\u043a\u0441",children:[Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/stock/unisex",children:"O\u0441\u0442\u0430\u0442\u043a\u0438"})},"unisexStock"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/sales/unisex",children:"\u041f\u0440\u043e\u0434\u0430\u0436\u0438"})},"unisexSales"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/brandsReport/unisex",children:"\u041e\u0442\u0447\u0435\u0442 \u043f\u043e \u0431\u0440\u0435\u043d\u0434\u0430\u043c "})},"unisexBrandReport")]},"unisex"),Object(r.jsxs)(jt,{title:"\u041e\u0431\u0449\u0435\u0435",children:[Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/stock/common",children:"O\u0441\u0442\u0430\u0442\u043a\u0438"})},"commonStock"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/sales/common",children:"\u041f\u0440\u043e\u0434\u0430\u0436\u0438"})},"commonSales"),Object(r.jsx)(f.a.Item,{children:Object(r.jsx)(b.b,{to:"/brandsReport/common",children:"\u041e\u0442\u0447\u0435\u0442 \u043f\u043e \u0431\u0440\u0435\u043d\u0434\u0430\u043c "})},"commonBrandReport")]},"common")]}),Object(r.jsx)(j.a,{exact:!0,path:"/stock/:sex",render:function(){return Object(r.jsx)($,{})}}),Object(r.jsx)(j.a,{path:"/sales/:sex",render:function(){return Object(r.jsx)(st,{counterparties:t.state.counterparties})}}),Object(r.jsx)(j.a,{path:"/brandsReport/:sex",render:function(){return Object(r.jsx)(bt,{})}})]})}}]),n}(c.a.Component);i.a.render(Object(r.jsx)(b.a,{children:Object(r.jsx)(ft,{})}),document.getElementById("root"))}},[[347,1,2]]]);
//# sourceMappingURL=main.339b20a4.chunk.js.map